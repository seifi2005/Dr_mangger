# راهنمای سیستم بک‌آپ

## دسترسی به صفحه بک‌آپ

از منوی **تنظیمات** → **بک‌آپ دیتابیس** می‌توانید به صفحه مدیریت بک‌آپ دسترسی پیدا کنید.

## ویژگی‌های سیستم بک‌آپ

### 1. ایجاد بک‌آپ دستی
- با کلیک روی دکمه "ایجاد بک‌آپ جدید" می‌توانید یک بک‌آپ کامل از دیتابیس ایجاد کنید
- بک‌آپ به صورت فایل SQL در پوشه `backups/` ذخیره می‌شود

### 2. مدیریت بک‌آپ‌ها
- **دانلود**: می‌توانید هر بک‌آپ را دانلود کنید
- **حذف**: می‌توانید بک‌آپ‌های قدیمی را حذف کنید
- **نمایش اطلاعات**: تاریخ ایجاد و حجم هر بک‌آپ نمایش داده می‌شود

### 3. پاک‌سازی خودکار
- سیستم به صورت خودکار فقط **2 بک‌آپ آخر** را نگه می‌دارد
- بک‌آپ‌های قدیمی‌تر به صورت خودکار حذف می‌شوند

### 4. پاک‌سازی لاگ‌ها
- لاگ‌های قدیمی‌تر از **20 روز** به صورت خودکار حذف می‌شوند
- می‌توانید به صورت دستی نیز لاگ‌های قدیمی را پاک کنید

## بک‌آپ خودکار روزانه

برای تنظیم بک‌آپ خودکار روزانه، فایل `cron_backup.php` را در Windows Task Scheduler یا Linux Cron اضافه کنید.

### Windows Task Scheduler

1. Task Scheduler را باز کنید
2. Create Basic Task را انتخاب کنید
3. نام: "Database Backup Daily"
4. Trigger: Daily (هر روز)
5. Time: ساعت مورد نظر (مثلاً 2:00 AM)
6. Action: Start a program
7. Program: `C:\xampp\php\php.exe`
8. Arguments: `C:\xampp\htdocs\medic\cron_backup.php`
9. Start in: `C:\xampp\htdocs\medic`

### Linux Cron

```bash
# ویرایش crontab
crontab -e

# اضافه کردن خط زیر برای اجرای بک‌آپ هر روز ساعت 2 صبح
0 2 * * * /usr/bin/php /path/to/medic/cron_backup.php >> /path/to/medic/backups/cron.log 2>&1
```

## ساختار فایل‌های بک‌آپ

- **مسیر**: `backups/backup_YYYY-MM-DD_HH-MM-SS.sql`
- **فرمت**: فایل SQL استاندارد MySQL
- **محتوا**: ساختار و داده‌های کامل دیتابیس

## بازگردانی بک‌آپ

برای بازگردانی یک بک‌آپ:

```bash
# در Command Line
mysql -u root -p medical_system < backups/backup_2024-01-15_02-00-00.sql
```

یا در phpMyAdmin:
1. دیتابیس `medical_system` را انتخاب کنید
2. به تب "Import" بروید
3. فایل بک‌آپ را انتخاب کنید
4. روی "Go" کلیک کنید

## نکات مهم

- بک‌آپ‌ها در پوشه `backups/` ذخیره می‌شوند
- فقط 2 بک‌آپ آخر نگه داشته می‌شوند
- لاگ‌های قدیمی‌تر از 20 روز حذف می‌شوند
- قبل از بازگردانی بک‌آپ، از دیتابیس فعلی بک‌آپ بگیرید

